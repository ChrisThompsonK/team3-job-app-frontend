{% extends "layout.njk" %}

{% block title %}Apply for {{ jobRole.name }} - Kainos Careers{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-5xl font-bold kainos-text-gradient">Apply for Job Role</h1>
    <a href="/jobs/{{ jobRole.id }}/details" class="bg-blue-800 hover:bg-blue-900 text-white font-semibold px-6 py-3 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 hover:scale-105 no-underline flex items-center gap-2">
      {{ icon('arrow-left', 'h-4 w-4') | safe }}
      Back to Job Details
    </a>
  </div>

  <!-- Job Role Summary Card -->
  <div class="card bg-blue-50 border-2 border-blue-200 shadow-lg mb-16">
    <div class="card-body">
      <h2 class="text-3xl font-bold mb-6 text-blue-900 text-center">{{ jobRole.name }}</h2>
      <div class="flex flex-col gap-4 text-base items-center justify-center">
        <div class="flex items-center gap-4">
          <span class="font-semibold text-blue-800">Location:</span>
          <span class="text-gray-700">{{ jobRole.location }}</span>
          <span class="mx-8 text-gray-400">|</span>
          <span class="font-semibold text-blue-800">Capability:</span>
          <span class="text-gray-700">{{ jobRole.capability }}</span>
        </div>
        <div class="flex items-center gap-4">
          <span class="font-semibold text-blue-800">Band:</span>
          <span class="text-gray-700">{{ jobRole.band }}</span>
          <span class="mx-8 text-gray-400">|</span>
          <span class="font-semibold text-blue-800">Closing Date:</span>
          <span class="text-gray-700">{{ jobRole.closingDate.toLocaleDateString('en-GB') if jobRole.closingDate else 'Open' }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Application Form -->
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h2 class="card-title text-2xl mb-6">Application Information</h2>
      
      <!-- Error Messages -->
      {% if errors and errors.length > 0 %}
      <div class="alert alert-error shadow-lg mb-6">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div>
            <h3 class="font-bold">Please correct the following errors:</h3>
            <ul class="list-disc list-inside mt-2">
              {% for error in errors %}
              <li>{{ error }}</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
      {% endif %}
      
      <form id="applicationForm" action="/jobs/{{ jobRole.id }}/apply" method="POST" enctype="multipart/form-data" class="space-y-6">
        <!-- Personal Information Section -->
        <div class="divider text-lg font-semibold text-blue-800">Personal Information</div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- First Name -->
          <div class="form-control bg-blue-50 p-4 rounded-lg border border-blue-200">
            <label class="label" for="firstName">
              <span class="label-text text-lg font-semibold">First Name *</span>
            </label>
            <input 
              type="text" 
              id="firstName"
              name="firstName" 
              placeholder="John" 
              value="{{ formData.firstName if formData else '' }}"
              class="input input-bordered input-lg w-full focus:input-primary transition-colors duration-200" 
              required
            />
          </div>

          <!-- Last Name -->
          <div class="form-control bg-blue-50 p-4 rounded-lg border border-blue-200">
            <label class="label" for="lastName">
              <span class="label-text text-lg font-semibold">Last Name *</span>
            </label>
            <input 
              type="text" 
              id="lastName"
              name="lastName" 
              placeholder="Doe" 
              value="{{ formData.lastName if formData else '' }}"
              class="input input-bordered input-lg w-full focus:input-primary transition-colors duration-200" 
              required
            />
          </div>

          <!-- Email -->
          <div class="form-control bg-blue-50 p-4 rounded-lg border border-blue-200">
            <label class="label" for="email">
              <span class="label-text text-lg font-semibold">Email Address *</span>
            </label>
            <input 
              type="email" 
              id="email"
              name="email" 
              placeholder="john.doe@example.com" 
              value="{{ formData.email if formData else (userEmail or '') }}"
              autocomplete="off"
              class="input input-bordered input-lg w-full focus:input-primary transition-colors duration-200" 
              required
            />
          </div>

          <!-- Phone -->
          <div class="form-control bg-blue-50 p-4 rounded-lg border border-blue-200">
            <label class="label" for="phone">
              <span class="label-text text-lg font-semibold">Phone Number *</span>
            </label>
            <div class="flex gap-2">
              <select 
                id="countryCode" 
                name="countryCode" 
                class="select select-bordered select-lg w-32 focus:select-primary transition-colors duration-200" 
                required
              >
                <option value="+44" {{ 'selected' if formData.countryCode == '+44' or not formData else '' }}>ðŸ‡¬ðŸ‡§ +44</option>
                <option value="+1">ðŸ‡ºðŸ‡¸ +1</option>
                <option value="+91">ðŸ‡®ðŸ‡³ +91</option>
                <option value="+86">ðŸ‡¨ðŸ‡³ +86</option>
                <option value="+81">ðŸ‡¯ðŸ‡µ +81</option>
                <option value="+49">ðŸ‡©ðŸ‡ª +49</option>
                <option value="+33">ðŸ‡«ðŸ‡· +33</option>
                <option value="+39">ðŸ‡®ðŸ‡¹ +39</option>
                <option value="+34">ðŸ‡ªðŸ‡¸ +34</option>
                <option value="+7">ðŸ‡·ðŸ‡º +7</option>
                <option value="+61">ðŸ‡¦ðŸ‡º +61</option>
                <option value="+55">ðŸ‡§ðŸ‡· +55</option>
                <option value="+27">ðŸ‡¿ðŸ‡¦ +27</option>
                <option value="+82">ðŸ‡°ðŸ‡· +82</option>
                <option value="+31">ðŸ‡³ðŸ‡± +31</option>
                <option value="+46">ðŸ‡¸ðŸ‡ª +46</option>
                <option value="+41">ðŸ‡¨ðŸ‡­ +41</option>
                <option value="+45">ðŸ‡©ðŸ‡° +45</option>
                <option value="+47">ðŸ‡³ðŸ‡´ +47</option>
                <option value="+48">ðŸ‡µðŸ‡± +48</option>
                <option value="+351">ðŸ‡µðŸ‡¹ +351</option>
                <option value="+353">ðŸ‡®ðŸ‡ª +353</option>
                <option value="+32">ðŸ‡§ðŸ‡ª +32</option>
                <option value="+43">ðŸ‡¦ðŸ‡¹ +43</option>
                <option value="+30">ðŸ‡¬ðŸ‡· +30</option>
                <option value="+420">ðŸ‡¨ðŸ‡¿ +420</option>
                <option value="+36">ðŸ‡­ðŸ‡º +36</option>
                <option value="+40">ðŸ‡·ðŸ‡´ +40</option>
                <option value="+359">ðŸ‡§ðŸ‡¬ +359</option>
                <option value="+385">ðŸ‡­ðŸ‡· +385</option>
                <option value="+64">ðŸ‡³ðŸ‡¿ +64</option>
                <option value="+65">ðŸ‡¸ðŸ‡¬ +65</option>
                <option value="+60">ðŸ‡²ðŸ‡¾ +60</option>
                <option value="+63">ðŸ‡µðŸ‡­ +63</option>
                <option value="+66">ðŸ‡¹ðŸ‡­ +66</option>
                <option value="+84">ðŸ‡»ðŸ‡³ +84</option>
                <option value="+62">ðŸ‡®ðŸ‡© +62</option>
                <option value="+20">ðŸ‡ªðŸ‡¬ +20</option>
                <option value="+234">ðŸ‡³ðŸ‡¬ +234</option>
                <option value="+254">ðŸ‡°ðŸ‡ª +254</option>
                <option value="+971">ðŸ‡¦ðŸ‡ª +971</option>
                <option value="+966">ðŸ‡¸ðŸ‡¦ +966</option>
                <option value="+972">ðŸ‡®ðŸ‡± +972</option>
                <option value="+90">ðŸ‡¹ðŸ‡· +90</option>
                <option value="+52">ðŸ‡²ðŸ‡½ +52</option>
                <option value="+54">ðŸ‡¦ðŸ‡· +54</option>
                <option value="+56">ðŸ‡¨ðŸ‡± +56</option>
                <option value="+57">ðŸ‡¨ðŸ‡´ +57</option>
                <option value="+51">ðŸ‡µðŸ‡ª +51</option>
              </select>
              <input 
                type="tel" 
                id="phone"
                name="phone" 
                placeholder="7XXX XXXXXX" 
                value="{{ formData.phone if formData else '' }}"
                class="input input-bordered input-lg flex-1 focus:input-primary transition-colors duration-200" 
                required
              />
            </div>
          </div>
        </div>

        <!-- Professional Information Section -->
        <div class="divider text-lg font-semibold text-blue-800">Professional Information</div>

        <div class="grid grid-cols-1 gap-6">
          <!-- Current Job Title -->
          <div class="form-control bg-blue-50 p-4 rounded-lg border border-blue-200">
            <label class="label" for="currentJobTitle">
              <span class="label-text text-lg font-semibold">Current/Most Recent Job Title *</span>
            </label>
            <input 
              type="text" 
              id="currentJobTitle"
              name="currentJobTitle" 
              placeholder="e.g., Software Engineer" 
              value="{{ formData.currentJobTitle if formData else '' }}"
              class="input input-bordered input-lg w-full focus:input-primary transition-colors duration-200" 
              required
            />
          </div>

          <!-- Years of Experience -->
          <div class="form-control bg-blue-50 p-4 rounded-lg border border-blue-200">
            <label class="label" for="yearsOfExperience">
              <span class="label-text text-lg font-semibold">Years of Experience *</span>
            </label>
            <select 
              id="yearsOfExperience" 
              name="yearsOfExperience" 
              class="select select-bordered select-lg w-full focus:select-primary transition-colors duration-200" 
              required
            >
              <option disabled {{ 'selected' if not formData or not formData.yearsOfExperience else '' }}>Select experience level</option>
              <option value="0-1" {{ 'selected' if formData and formData.yearsOfExperience == '0-1' else '' }}>0-1 years</option>
              <option value="1-3" {{ 'selected' if formData and formData.yearsOfExperience == '1-3' else '' }}>1-3 years</option>
              <option value="3-5" {{ 'selected' if formData and formData.yearsOfExperience == '3-5' else '' }}>3-5 years</option>
              <option value="5-10" {{ 'selected' if formData and formData.yearsOfExperience == '5-10' else '' }}>5-10 years</option>
              <option value="10+" {{ 'selected' if formData and formData.yearsOfExperience == '10+' else '' }}>10+ years</option>
            </select>
          </div>

          <!-- LinkedIn Profile -->
          <div class="form-control bg-blue-50 p-4 rounded-lg border border-blue-200">
            <label class="label" for="linkedinUrl">
              <span class="label-text text-lg font-semibold">LinkedIn Profile</span>
            </label>
            <input 
              type="url" 
              id="linkedinUrl"
              name="linkedinUrl" 
              placeholder="https://www.linkedin.com/in/yourprofile" 
              value="{{ formData.linkedinUrl if formData else '' }}"
              class="input input-bordered input-lg w-full focus:input-primary transition-colors duration-200"
            />
            <label class="label">
              <span class="label-text-alt text-sm opacity-70">Optional</span>
            </label>
          </div>

          <!-- CV Upload -->
          <div class="form-control bg-blue-50 p-4 rounded-lg border border-blue-200">
              <label class="label" for="cv">
                <span class="label-text text-lg font-semibold">Upload CV/Resume *</span>
              </label>
              <input 
                type="file" 
                id="cv"
                name="cv"
                accept=".pdf,.doc,.docx"
                class="file-input file-input-bordered file-input-lg w-full focus:file-input-primary transition-colors duration-200" 
                required
              />
              <label class="label">
                <span class="label-text-alt text-sm opacity-70">Accepted formats: PDF, DOC, DOCX (Max 5MB)</span>
              </label>
          </div>

          <!-- Cover Letter -->
          <div class="form-control bg-blue-50 p-4 rounded-lg border border-blue-200">
            <label class="label" for="coverLetter">
              <span class="label-text text-lg font-semibold">Cover Letter *</span>
            </label>
            <textarea 
              id="coverLetter"
              name="coverLetter" 
              class="textarea textarea-bordered textarea-lg h-40 resize-none w-full focus:textarea-primary transition-colors duration-200" 
              placeholder="Tell us why you're interested in this role and what makes you a great fit for Kainos..."
              required
            >{{ formData.coverLetter if formData else '' }}</textarea>
            <label class="label">
              <span class="label-text-alt text-sm opacity-70">Required</span>
            </label>
          </div>
        </div>

        <!-- Additional Comments -->
        <div class="form-control bg-blue-50 p-4 rounded-lg border border-blue-200">
          <label class="label" for="additionalComments">
            <span class="label-text text-lg font-semibold">Additional Comments</span>
          </label>
          <textarea 
            id="additionalComments"
            name="additionalComments" 
            class="textarea textarea-bordered textarea-lg h-24 resize-none w-full focus:textarea-primary transition-colors duration-200" 
            placeholder="Any additional information you'd like to share..."
          >{{ formData.additionalComments if formData else '' }}</textarea>
          <label class="label">
            <span class="label-text-alt text-sm opacity-70">Optional</span>
          </label>
        </div>

        <!-- Terms and Conditions -->
        <div class="form-control bg-blue-50 p-4 rounded-lg border border-blue-200">
          <label class="label cursor-pointer justify-start gap-4">
            <input type="checkbox" name="acceptTerms" class="checkbox checkbox-primary checkbox-lg" required />
            <span class="label-text text-base">
              I confirm that the information provided is accurate and I agree to Kainos' 
              <a href="https://www.kainos.com/information/privacy-notice/" target="_blank" class="link link-primary">privacy policy</a> and 
              <a href="https://www.kainos.com/information/legal/" target="_blank" class="link link-primary">terms of service</a> *
            </span>
          </label>
        </div>
      </form>
    </div>
  </div>

  <!-- Form Actions - Outside the card -->
  <div class="mt-8 mb-12 flex flex-col sm:flex-row gap-4 justify-center items-center">
    <a href="/jobs/{{ jobRole.id }}/details" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold px-8 py-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 hover:scale-105 no-underline text-center min-w-[160px]">
      Cancel
    </a>
    <button type="submit" id="submitBtn" form="applicationForm" class="bg-blue-700 hover:bg-blue-800 text-white font-semibold px-8 py-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 hover:scale-105 text-center min-w-[160px] flex items-center justify-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:hover:scale-100" disabled>
      {{ icon('send', 'h-5 w-5') | safe }}
      Submit Application
    </button>
  </div>
</div>

<script>
  // Phone number format examples for different countries
  const phoneFormats = {
    '+44': '7XXX XXXXXX',      // UK
    '+1': '(555) 123-4567',    // US/Canada
    '+91': '98765 43210',      // India
    '+86': '138 0013 8000',    // China
    '+81': '90-1234-5678',     // Japan
    '+49': '151 23456789',     // Germany
    '+33': '6 12 34 56 78',    // France
    '+39': '312 345 6789',     // Italy
    '+34': '612 34 56 78',     // Spain
    '+7': '912 345-67-89',     // Russia
    '+61': '412 345 678',      // Australia
    '+55': '(11) 91234-5678',  // Brazil
    '+27': '82 123 4567',      // South Africa
    '+82': '10-1234-5678',     // South Korea
    '+31': '6 12345678',       // Netherlands
    '+46': '70-123 45 67',     // Sweden
    '+41': '78 123 45 67',     // Switzerland
    '+45': '12 34 56 78',      // Denmark
    '+47': '412 34 567',       // Norway
    '+48': '512 345 678',      // Poland
    '+351': '912 345 678',     // Portugal
    '+353': '85 123 4567',     // Ireland
    '+32': '470 12 34 56',     // Belgium
    '+43': '664 1234567',      // Austria
    '+30': '691 234 5678',     // Greece
    '+420': '601 123 456',     // Czech Republic
    '+36': '20 123 4567',      // Hungary
    '+40': '712 345 678',      // Romania
    '+359': '87 123 4567',     // Bulgaria
    '+385': '91 234 5678',     // Croatia
    '+64': '21 123 4567',      // New Zealand
    '+65': '8123 4567',        // Singapore
    '+60': '12-345 6789',      // Malaysia
    '+63': '917 123 4567',     // Philippines
    '+66': '81 234 5678',      // Thailand
    '+84': '91 234 5678',      // Vietnam
    '+62': '812-3456-7890',    // Indonesia
    '+20': '100 123 4567',     // Egypt
    '+234': '802 123 4567',    // Nigeria
    '+254': '712 345678',      // Kenya
    '+971': '50 123 4567',     // UAE
    '+966': '50 123 4567',     // Saudi Arabia
    '+972': '50-123-4567',     // Israel
    '+90': '532 123 4567',     // Turkey
    '+52': '55 1234 5678',     // Mexico
    '+54': '11 2345-6789',     // Argentina
    '+56': '9 1234 5678',      // Chile
    '+57': '321 1234567',      // Colombia
    '+51': '987 654 321'       // Peru
  };

  // Form validation to enable/disable submit button
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('applicationForm');
    const submitBtn = document.getElementById('submitBtn');
    const countryCodeSelect = document.getElementById('countryCode');
    const phoneInput = document.getElementById('phone');
    
    // Update phone placeholder based on country code
    function updatePhonePlaceholder() {
      const selectedCode = countryCodeSelect.value;
      const format = phoneFormats[selectedCode] || 'Enter phone number';
      phoneInput.placeholder = format;
    }
    
    // Listen for country code changes
    countryCodeSelect.addEventListener('change', updatePhonePlaceholder);
    
    // Set initial placeholder
    updatePhonePlaceholder();
    
    function validateForm() {
      // Get all required fields
      const firstName = document.getElementById('firstName').value.trim();
      const lastName = document.getElementById('lastName').value.trim();
      const email = document.getElementById('email').value.trim();
      const countryCode = document.getElementById('countryCode').value;
      const phone = document.getElementById('phone').value.trim();
      const currentJobTitle = document.getElementById('currentJobTitle').value.trim();
      const yearsOfExperience = document.getElementById('yearsOfExperience').value;
      const cv = document.getElementById('cv').files.length > 0;
      const coverLetter = document.getElementById('coverLetter').value.trim();
      const acceptTerms = document.querySelector('input[name="acceptTerms"]').checked;
      
      // Validate email format
      const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      
  // Validate cover letter is not empty
  const coverLetterValid = coverLetter.length > 0;
      
      // Enable submit button only if all required fields are valid
      const allValid = firstName && lastName && emailValid && countryCode && phone && 
                       currentJobTitle && yearsOfExperience && cv && 
                       coverLetterValid && acceptTerms;
      
      submitBtn.disabled = !allValid;
    }
    
    // Add event listeners to all form inputs
    const inputs = form.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
      input.addEventListener('input', validateForm);
      input.addEventListener('change', validateForm);
    });
    
    // Initial validation on page load
    validateForm();
  });
</script>

{% endblock %}
